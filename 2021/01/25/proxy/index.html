<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>proxy | Hexo</title>
  <meta name="keywords" content=" proxyä»£ç† ">
  <meta name="description" content="proxy | Hexo">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="1. historyæ¨¡å¼ï¼Œé¡µé¢è¿”å›404ï¼Œå¦‚ä½•è§£å†³?historyæ˜¯html5æ–°å¢çš„apiï¼Œä»–çš„åŠŸèƒ½æ˜¯ä¿®æ”¹åœ°å€æ ä½†æ˜¯ä¸åƒæœåŠ¡å™¨ç«¯å‘é€çœŸæ˜¯è¯·æ±‚ï¼Œå¦‚æœé¡µé¢è¿”å›404ï¼Œè¯´æ˜å‘é€äº†è¯·æ±‚åˆ°æœåŠ¡å™¨ç«¯,å¹¶ä¸”æœåŠ¡å™¨ç«¯å¯¹è¯¥è¯·æ±‚æ²¡æœ‰åšå¤„ç†ï¼Œé‚£ä¹ˆè§£å†³404çš„æ–¹æ¡ˆå°±æ˜¯æœåŠ¡å™¨ç«¯å¯¹äºè¿™ç±»è¯·æ±‚é‡å®šå‘åˆ°æŸä¸ªé¡µé¢å³å¯ 2.èŠä¸€èŠcommonjsè§„èŒƒæ¦‚è¿° ï¼š nodeåº”ç”¨ç”±æ¨¡å—ç»„æˆï¼Œé‡‡ç”¨çš„commonjsæ¨¡å—è§„èŒƒã€‚æ¯ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ª">
<meta property="og:type" content="article">
<meta property="og:title" content="vueé¢è¯•é¢˜æ•´ç†">
<meta property="og:url" content="http://example.com/2021/01/28/vue%E9%9D%A2%E8%AF%95%E9%A2%98%E6%95%B4%E7%90%86/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="1. historyæ¨¡å¼ï¼Œé¡µé¢è¿”å›404ï¼Œå¦‚ä½•è§£å†³?historyæ˜¯html5æ–°å¢çš„apiï¼Œä»–çš„åŠŸèƒ½æ˜¯ä¿®æ”¹åœ°å€æ ä½†æ˜¯ä¸åƒæœåŠ¡å™¨ç«¯å‘é€çœŸæ˜¯è¯·æ±‚ï¼Œå¦‚æœé¡µé¢è¿”å›404ï¼Œè¯´æ˜å‘é€äº†è¯·æ±‚åˆ°æœåŠ¡å™¨ç«¯,å¹¶ä¸”æœåŠ¡å™¨ç«¯å¯¹è¯¥è¯·æ±‚æ²¡æœ‰åšå¤„ç†ï¼Œé‚£ä¹ˆè§£å†³404çš„æ–¹æ¡ˆå°±æ˜¯æœåŠ¡å™¨ç«¯å¯¹äºè¿™ç±»è¯·æ±‚é‡å®šå‘åˆ°æŸä¸ªé¡µé¢å³å¯ 2.èŠä¸€èŠcommonjsè§„èŒƒæ¦‚è¿° ï¼š nodeåº”ç”¨ç”±æ¨¡å—ç»„æˆï¼Œé‡‡ç”¨çš„commonjsæ¨¡å—è§„èŒƒã€‚æ¯ä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ª">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-01-28T13:01:50.000Z">
<meta property="article:modified_time" content="2021-01-29T01:09:07.336Z">
<meta property="article:author" content="å‰ç«¯èœé¸Ÿ">
<meta name="twitter:card" content="summary">


<link rel="icon" href="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3014093926,41837070&fm=26&gp=0.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 5.3.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/" class="avatar_target">
    <img class="avatar" src="https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=3014093926,41837070&amp;fm=26&amp;gp=0.jpg" />
</a>
<div class="author">
    <span>å‰ç«¯èœé¸Ÿ</span>
</div>

<div class="icon">
    
        
        <a title="rss" href="/atom.xml" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-rss"></use>
                </svg>
            
        </a>
        
    
        
        <a title="github" href="https://github.com/18801214376lk" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-github"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
        <a title="weibo" href="https://weibo.com/u/7384469670/home?wvr=5" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-weibo"></use>
                </svg>
            
        </a>
        
    
        
    
        
    
        
    
        
        <a title="juejin" href="https://juejin.cn/user/4344919342731837" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-juejin"></use>
                </svg>
            
        </a>
        
    
        
        <a title="email" href="mailto:18801214376@qq.com" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-email"></use>
                </svg>
            
        </a>
        
    
        
        <a title="qq" href="http://wpa.qq.com/msgrd?v=3&uin=2655883468&site=qq&menu=yes" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-qq"></use>
                </svg>
            
        </a>
        
    
        
        <a title="kugou" href="https://www.kugou.com/" target="_blank">
            
                <svg class="iconfont-svg" aria-hidden="true">
                    <use xlink:href="#icon-kugou"></use>
                </svg>
            
        </a>
        
    
</div>



<a class="more-menus">æ›´å¤šèœå•</a>


<ul>
    <li><div class="all active" data-rel="All">All<small>(10)</small></div></li>
    
</ul>
<div class="left-bottom">
    <div class="menus">
    
    
    <a class="dynamic-menu site_url"   href="/photo">ç›¸å†Œ</a>
    
    
    
    </div>
    <div><a class="about  hasFriend  site_url"  href="/about">äº”ç¦ä¸´é—¨</a><a style="width: 50%"  class="friends">å°ç™½</a></div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="10">

<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="æœç´¢ å¿«æ·é”® i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="åˆ‡æ¢åˆ°å¤§çº²è§†å›¾ å¿«æ·é”® w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="è¿”å›"></i>
            <input id="local-search-input" />
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="å¤§å°å†™æ•æ„Ÿ"></i>
            <i class="iconfont icon-tag" data-title="æ ‡ç­¾"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">å¤§çº²</div>
            <i class="iconfont icon-list" data-title="åˆ‡æ¢åˆ°æ–‡ç« åˆ—è¡¨"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>js</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>proxyä»£ç†</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>å‰ç«¯</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        <a  class="All "
           href="/2021/01/28/vue%E9%9D%A2%E8%AF%95%E9%A2%98%E6%95%B4%E7%90%86/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="vueé¢è¯•é¢˜æ•´ç†">vueé¢è¯•é¢˜æ•´ç†</span>
            <span class="post-date" title="2021-01-28 21:01:50">2021/01/28</span>
        </a>
        
        <a  class="All "
           href="/2021/01/25/proxy/"
           data-tag="proxyä»£ç†"
           data-author="" >
            <span class="post-title" title="proxy">proxy</span>
            <span class="post-date" title="2021-01-25 21:07:06">2021/01/25</span>
        </a>
        
        <a  class="All "
           href="/2021/01/12/%E9%98%B2%E6%8A%96%E4%B8%8E%E8%8A%82%E6%B5%81/"
           data-tag="å‰ç«¯"
           data-author="" >
            <span class="post-title" title="é˜²æŠ–ä¸èŠ‚æµ">é˜²æŠ–ä¸èŠ‚æµ</span>
            <span class="post-date" title="2021-01-12 08:38:47">2021/01/12</span>
        </a>
        
        <a  class="All "
           href="/2021/01/11/%E5%90%8C%E6%BA%90%E5%8F%8A%E8%B7%A8%E5%9F%9F/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="åŒæºåŠè·¨åŸŸ">åŒæºåŠè·¨åŸŸ</span>
            <span class="post-date" title="2021-01-11 15:23:43">2021/01/11</span>
        </a>
        
        <a  class="All "
           href="/2021/01/04/Object/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="TypeScript">TypeScript</span>
            <span class="post-date" title="2021-01-04 08:30:13">2021/01/04</span>
        </a>
        
        <a  class="All "
           href="/2020/12/30/TypeScript/"
           data-tag="js"
           data-author="" >
            <span class="post-title" title="TypeScript">TypeScript</span>
            <span class="post-date" title="2020-12-30 08:30:13">2020/12/30</span>
        </a>
        
        <a  class="All "
           href="/2020/12/30/%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="JavaScriptçš„ä¸¥æ ¼æ¨¡å¼">JavaScriptçš„ä¸¥æ ¼æ¨¡å¼</span>
            <span class="post-date" title="2020-12-30 08:30:13">2020/12/30</span>
        </a>
        
        <a  class="All "
           href="/2020/12/28/class/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="classçš„æ€»ç»“">classçš„æ€»ç»“</span>
            <span class="post-date" title="2020-12-28 20:39:20">2020/12/28</span>
        </a>
        
        <a  class="All "
           href="/2020/12/27/hook/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="hookçš„æ•´ç†ä½¿ç”¨">hookçš„æ•´ç†ä½¿ç”¨</span>
            <span class="post-date" title="2020-12-27 19:40:43">2020/12/27</span>
        </a>
        
        <a  class="All "
           href="/2020/12/25/hello-world/"
           data-tag=""
           data-author="" >
            <span class="post-title" title="Hello World">Hello World</span>
            <span class="post-date" title="2020-12-25 14:31:04">2020/12/25</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>
    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-proxy" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">proxy</h1>
    
    <div class="article-meta">
        
        
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color3">proxyä»£ç†</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2021-01-25 21:13:11'>2021-01-25 21:07</time>
        
    </div>
    <div class="article-meta">
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
        <span class="top-comment" title="è·³è½¬è‡³è¯„è®ºåŒº">
            <a href="#comments">
                Comment:<span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </a>
        </span>
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-text">æ¦‚è¿°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Proxy-%E5%AE%9E%E4%BE%8B%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-text">Proxy å®ä¾‹çš„æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#get"><span class="toc-text">get()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set"><span class="toc-text">set()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#apply"><span class="toc-text">apply()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#has"><span class="toc-text">has()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#construct"><span class="toc-text">construct()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deleteProperty"><span class="toc-text">deleteProperty()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#defineProperty"><span class="toc-text">defineProperty()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getOwnPropertyDescriptor"><span class="toc-text">getOwnPropertyDescriptor()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getPrototypeOf"><span class="toc-text">getPrototypeOf()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#isExtensible"><span class="toc-text">isExtensible()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ownKeys"><span class="toc-text">ownKeys()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#preventExtensions"><span class="toc-text">preventExtensions()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setPrototypeOf"><span class="toc-text">setPrototypeOf()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Proxy-revocable"><span class="toc-text">Proxy.revocable()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#this-%E9%97%AE%E9%A2%98"><span class="toc-text">this é—®é¢˜</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%EF%BC%9AWeb-%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">å®ä¾‹ï¼šWeb æœåŠ¡çš„å®¢æˆ·ç«¯</span></a></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>Proxy ç”¨äºä¿®æ”¹æŸäº›æ“ä½œçš„é»˜è®¤è¡Œä¸ºï¼Œç­‰åŒäºåœ¨è¯­è¨€å±‚é¢åšå‡ºä¿®æ”¹ï¼Œæ‰€ä»¥å±äºä¸€ç§â€œå…ƒç¼–ç¨‹â€ï¼ˆmeta programmingï¼‰ï¼Œå³å¯¹ç¼–ç¨‹è¯­è¨€è¿›è¡Œç¼–ç¨‹ã€‚</p>
<p>Proxy å¯ä»¥ç†è§£æˆï¼Œåœ¨ç›®æ ‡å¯¹è±¡ä¹‹å‰æ¶è®¾ä¸€å±‚â€œæ‹¦æˆªâ€ï¼Œå¤–ç•Œå¯¹è¯¥å¯¹è±¡çš„è®¿é—®ï¼Œéƒ½å¿…é¡»å…ˆé€šè¿‡è¿™å±‚æ‹¦æˆªï¼Œå› æ­¤æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥å¯¹å¤–ç•Œçš„è®¿é—®è¿›è¡Œè¿‡æ»¤å’Œæ”¹å†™ã€‚Proxy è¿™ä¸ªè¯çš„åŸæ„æ˜¯ä»£ç†ï¼Œç”¨åœ¨è¿™é‡Œè¡¨ç¤ºç”±å®ƒæ¥â€œä»£ç†â€æŸäº›æ“ä½œï¼Œå¯ä»¥è¯‘ä¸ºâ€œä»£ç†å™¨â€ã€‚</p>
<pre><code class="javascript">var obj = new Proxy(&#123;&#125;, &#123;
  get: function (target, propKey, receiver) &#123;
    console.log(`getting $&#123;propKey&#125;!`);
    return Reflect.get(target, propKey, receiver);
  &#125;,
  set: function (target, propKey, value, receiver) &#123;
    console.log(`setting $&#123;propKey&#125;!`);
    return Reflect.set(target, propKey, value, receiver);
  &#125;
&#125;);</code></pre>
<p>ä¸Šé¢ä»£ç å¯¹ä¸€ä¸ªç©ºå¯¹è±¡æ¶è®¾äº†ä¸€å±‚æ‹¦æˆªï¼Œé‡å®šä¹‰äº†å±æ€§çš„è¯»å–ï¼ˆ<code>get</code>ï¼‰å’Œè®¾ç½®ï¼ˆ<code>set</code>ï¼‰è¡Œä¸ºã€‚è¿™é‡Œæš‚æ—¶å…ˆä¸è§£é‡Šå…·ä½“çš„è¯­æ³•ï¼Œåªçœ‹è¿è¡Œç»“æœã€‚å¯¹è®¾ç½®äº†æ‹¦æˆªè¡Œä¸ºçš„å¯¹è±¡<code>obj</code>ï¼Œå»è¯»å†™å®ƒçš„å±æ€§ï¼Œå°±ä¼šå¾—åˆ°ä¸‹é¢çš„ç»“æœã€‚</p>
<pre><code class="javascript">obj.count = 1
//  setting count!
++obj.count
//  getting count!
//  setting count!
//  2</code></pre>
<p>ä¸Šé¢ä»£ç è¯´æ˜ï¼ŒProxy å®é™…ä¸Šé‡è½½ï¼ˆoverloadï¼‰äº†ç‚¹è¿ç®—ç¬¦ï¼Œå³ç”¨è‡ªå·±çš„å®šä¹‰è¦†ç›–äº†è¯­è¨€çš„åŸå§‹å®šä¹‰ã€‚</p>
<p>ES6 åŸç”Ÿæä¾› Proxy æ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ Proxy å®ä¾‹ã€‚</p>
<pre><code class="javascript">var proxy = new Proxy(target, handler);</code></pre>
<p>Proxy å¯¹è±¡çš„æ‰€æœ‰ç”¨æ³•ï¼Œéƒ½æ˜¯ä¸Šé¢è¿™ç§å½¢å¼ï¼Œä¸åŒçš„åªæ˜¯<code>handler</code>å‚æ•°çš„å†™æ³•ã€‚å…¶ä¸­ï¼Œ<code>new Proxy()</code>è¡¨ç¤ºç”Ÿæˆä¸€ä¸ª<code>Proxy</code>å®ä¾‹ï¼Œ<code>target</code>å‚æ•°è¡¨ç¤ºæ‰€è¦æ‹¦æˆªçš„ç›®æ ‡å¯¹è±¡ï¼Œ<code>handler</code>å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥å®šåˆ¶æ‹¦æˆªè¡Œä¸ºã€‚</p>
<p>ä¸‹é¢æ˜¯å¦ä¸€ä¸ªæ‹¦æˆªè¯»å–å±æ€§è¡Œä¸ºçš„ä¾‹å­ã€‚</p>
<pre><code class="javascript">var proxy = new Proxy(&#123;&#125;, &#123;
  get: function(target, propKey) &#123;
    return 35;
  &#125;
&#125;);

proxy.time // 35
proxy.name // 35
proxy.title // 35</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œä½œä¸ºæ„é€ å‡½æ•°ï¼Œ<code>Proxy</code>æ¥å—ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ‰€è¦ä»£ç†çš„ç›®æ ‡å¯¹è±¡ï¼ˆä¸Šä¾‹æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼‰ï¼Œå³å¦‚æœæ²¡æœ‰<code>Proxy</code>çš„ä»‹å…¥ï¼Œæ“ä½œåŸæ¥è¦è®¿é—®çš„å°±æ˜¯è¿™ä¸ªå¯¹è±¡ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œå¯¹äºæ¯ä¸€ä¸ªè¢«ä»£ç†çš„æ“ä½œï¼Œéœ€è¦æä¾›ä¸€ä¸ªå¯¹åº”çš„å¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†æ‹¦æˆªå¯¹åº”çš„æ“ä½œã€‚æ¯”å¦‚ï¼Œä¸Šé¢ä»£ç ä¸­ï¼Œé…ç½®å¯¹è±¡æœ‰ä¸€ä¸ª<code>get</code>æ–¹æ³•ï¼Œç”¨æ¥æ‹¦æˆªå¯¹ç›®æ ‡å¯¹è±¡å±æ€§çš„è®¿é—®è¯·æ±‚ã€‚<code>get</code>æ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ç›®æ ‡å¯¹è±¡å’Œæ‰€è¦è®¿é—®çš„å±æ€§ã€‚å¯ä»¥çœ‹åˆ°ï¼Œç”±äºæ‹¦æˆªå‡½æ•°æ€»æ˜¯è¿”å›<code>35</code>ï¼Œæ‰€ä»¥è®¿é—®ä»»ä½•å±æ€§éƒ½å¾—åˆ°<code>35</code>ã€‚</p>
<p>æ³¨æ„ï¼Œè¦ä½¿å¾—<code>Proxy</code>èµ·ä½œç”¨ï¼Œå¿…é¡»é’ˆå¯¹<code>Proxy</code>å®ä¾‹ï¼ˆä¸Šä¾‹æ˜¯<code>proxy</code>å¯¹è±¡ï¼‰è¿›è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯é’ˆå¯¹ç›®æ ‡å¯¹è±¡ï¼ˆä¸Šä¾‹æ˜¯ç©ºå¯¹è±¡ï¼‰è¿›è¡Œæ“ä½œã€‚</p>
<p>å¦‚æœ<code>handler</code>æ²¡æœ‰è®¾ç½®ä»»ä½•æ‹¦æˆªï¼Œé‚£å°±ç­‰åŒäºç›´æ¥é€šå‘åŸå¯¹è±¡ã€‚</p>
<pre><code class="javascript">var target = &#123;&#125;;
var handler = &#123;&#125;;
var proxy = new Proxy(target, handler);
proxy.a = &#39;b&#39;;
target.a // &quot;b&quot;</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>handler</code>æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œæ²¡æœ‰ä»»ä½•æ‹¦æˆªæ•ˆæœï¼Œè®¿é—®<code>proxy</code>å°±ç­‰åŒäºè®¿é—®<code>target</code>ã€‚</p>
<p>ä¸€ä¸ªæŠ€å·§æ˜¯å°† Proxy å¯¹è±¡ï¼Œè®¾ç½®åˆ°<code>object.proxy</code>å±æ€§ï¼Œä»è€Œå¯ä»¥åœ¨<code>object</code>å¯¹è±¡ä¸Šè°ƒç”¨ã€‚</p>
<pre><code class="javascript">var object = &#123; proxy: new Proxy(target, handler) &#125;;</code></pre>
<p>Proxy å®ä¾‹ä¹Ÿå¯ä»¥ä½œä¸ºå…¶ä»–å¯¹è±¡çš„åŸå‹å¯¹è±¡ã€‚</p>
<pre><code class="javascript">var proxy = new Proxy(&#123;&#125;, &#123;
  get: function(target, propKey) &#123;
    return 35;
  &#125;
&#125;);

let obj = Object.create(proxy);
obj.time // 35</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>proxy</code>å¯¹è±¡æ˜¯<code>obj</code>å¯¹è±¡çš„åŸå‹ï¼Œ<code>obj</code>å¯¹è±¡æœ¬èº«å¹¶æ²¡æœ‰<code>time</code>å±æ€§ï¼Œæ‰€ä»¥æ ¹æ®åŸå‹é“¾ï¼Œä¼šåœ¨<code>proxy</code>å¯¹è±¡ä¸Šè¯»å–è¯¥å±æ€§ï¼Œå¯¼è‡´è¢«æ‹¦æˆªã€‚</p>
<p>åŒä¸€ä¸ªæ‹¦æˆªå™¨å‡½æ•°ï¼Œå¯ä»¥è®¾ç½®æ‹¦æˆªå¤šä¸ªæ“ä½œã€‚</p>
<pre><code class="javascript">var handler = &#123;
  get: function(target, name) &#123;
    if (name === &#39;prototype&#39;) &#123;
      return Object.prototype;
    &#125;
    return &#39;Hello, &#39; + name;
  &#125;,

  apply: function(target, thisBinding, args) &#123;
    return args[0];
  &#125;,

  construct: function(target, args) &#123;
    return &#123;value: args[1]&#125;;
  &#125;
&#125;;

var fproxy = new Proxy(function(x, y) &#123;
  return x + y;
&#125;, handler);

fproxy(1, 2) // 1
new fproxy(1, 2) // &#123;value: 2&#125;
fproxy.prototype === Object.prototype // true
fproxy.foo === &quot;Hello, foo&quot; // true</code></pre>
<p>å¯¹äºå¯ä»¥è®¾ç½®ã€ä½†æ²¡æœ‰è®¾ç½®æ‹¦æˆªçš„æ“ä½œï¼Œåˆ™ç›´æ¥è½åœ¨ç›®æ ‡å¯¹è±¡ä¸Šï¼ŒæŒ‰ç…§åŸå…ˆçš„æ–¹å¼äº§ç”Ÿç»“æœã€‚</p>
<p>ä¸‹é¢æ˜¯ Proxy æ”¯æŒçš„æ‹¦æˆªæ“ä½œä¸€è§ˆï¼Œä¸€å…± 13 ç§ã€‚</p>
<ul>
<li>get(target, propKey, receiver)ï¼šæ‹¦æˆªå¯¹è±¡å±æ€§çš„è¯»å–ï¼Œæ¯”å¦‚proxy.fooå’Œproxy[â€˜fooâ€™]ã€‚</li>
<li>set(target, propKey, value, receiver)ï¼šæ‹¦æˆªå¯¹è±¡å±æ€§çš„è®¾ç½®ï¼Œæ¯”å¦‚proxy.foo = væˆ–proxy[â€˜fooâ€™] = vï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li>
<li>has(target, propKey)ï¼šæ‹¦æˆªpropKey in proxyçš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li>
<li>deleteProperty(target, propKey)ï¼šæ‹¦æˆªdelete proxy[propKey]çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li>
<li>ownKeys(target)ï¼šæ‹¦æˆªObject.getOwnPropertyNames(proxy)ã€Object.getOwnPropertySymbols(proxy)ã€Object.keys(proxy)ã€forâ€¦inå¾ªç¯ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚è¯¥æ–¹æ³•è¿”å›ç›®æ ‡å¯¹è±¡æ‰€æœ‰è‡ªèº«çš„å±æ€§çš„å±æ€§åï¼Œè€ŒObject.keys()çš„è¿”å›ç»“æœä»…åŒ…æ‹¬ç›®æ ‡å¯¹è±¡è‡ªèº«çš„å¯éå†å±æ€§ã€‚</li>
<li>getOwnPropertyDescriptor(target, propKey)ï¼šæ‹¦æˆªObject.getOwnPropertyDescriptor(proxy, propKey)ï¼Œè¿”å›å±æ€§çš„æè¿°å¯¹è±¡ã€‚</li>
<li>defineProperty(target, propKey, propDesc)ï¼šæ‹¦æˆªObject.defineProperty(proxy, propKey, propDescï¼‰ã€Object.defineProperties(proxy, propDescs)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li>
<li>preventExtensions(target)ï¼šæ‹¦æˆªObject.preventExtensions(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li>
<li>getPrototypeOf(target)ï¼šæ‹¦æˆªObject.getPrototypeOf(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚</li>
<li>isExtensible(target)ï¼šæ‹¦æˆªObject.isExtensible(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li>
<li>setPrototypeOf(target, proto)ï¼šæ‹¦æˆªObject.setPrototypeOf(proxy, proto)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚å¦‚æœç›®æ ‡å¯¹è±¡æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆè¿˜æœ‰ä¸¤ç§é¢å¤–æ“ä½œå¯ä»¥æ‹¦æˆªã€‚</li>
<li>apply(target, object, args)ï¼šæ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºå‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚proxy(â€¦args)ã€proxy.call(object, â€¦args)ã€proxy.apply(â€¦)ã€‚</li>
<li>construct(target, args)ï¼šæ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚new proxy(â€¦args)ã€‚</li>
</ul>
<h2 id="Proxy-å®ä¾‹çš„æ–¹æ³•"><a href="#Proxy-å®ä¾‹çš„æ–¹æ³•" class="headerlink" title="Proxy å®ä¾‹çš„æ–¹æ³•"></a>Proxy å®ä¾‹çš„æ–¹æ³•</h2><p>ä¸‹é¢æ˜¯ä¸Šé¢è¿™äº›æ‹¦æˆªæ–¹æ³•çš„è¯¦ç»†ä»‹ç»ã€‚</p>
<h3 id="get"><a href="#get" class="headerlink" title="get()"></a>get()</h3><p><code>get</code>æ–¹æ³•ç”¨äºæ‹¦æˆªæŸä¸ªå±æ€§çš„è¯»å–æ“ä½œï¼Œå¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œä¾æ¬¡ä¸ºç›®æ ‡å¯¹è±¡ã€å±æ€§åå’Œ proxy å®ä¾‹æœ¬èº«ï¼ˆä¸¥æ ¼åœ°è¯´ï¼Œæ˜¯æ“ä½œè¡Œä¸ºæ‰€é’ˆå¯¹çš„å¯¹è±¡ï¼‰ï¼Œå…¶ä¸­æœ€åä¸€ä¸ªå‚æ•°å¯é€‰ã€‚</p>
<p><code>get</code>æ–¹æ³•çš„ç”¨æ³•ï¼Œä¸Šæ–‡å·²ç»æœ‰ä¸€ä¸ªä¾‹å­ï¼Œä¸‹é¢æ˜¯å¦ä¸€ä¸ªæ‹¦æˆªè¯»å–æ“ä½œçš„ä¾‹å­ã€‚</p>
<pre><code class="javascript">var person = &#123;
  name: &quot;å¼ ä¸‰&quot;
&#125;;

var proxy = new Proxy(person, &#123;
  get: function(target, propKey) &#123;
    if (propKey in target) &#123;
      return target[propKey];
    &#125; else &#123;
      throw new ReferenceError(&quot;Prop name \&quot;&quot; + propKey + &quot;\&quot; does not exist.&quot;);
    &#125;
  &#125;
&#125;);

proxy.name // &quot;å¼ ä¸‰&quot;
proxy.age // æŠ›å‡ºä¸€ä¸ªé”™è¯¯</code></pre>
<p>ä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œå¦‚æœè®¿é—®ç›®æ ‡å¯¹è±¡ä¸å­˜åœ¨çš„å±æ€§ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªæ‹¦æˆªå‡½æ•°ï¼Œè®¿é—®ä¸å­˜åœ¨çš„å±æ€§ï¼Œåªä¼šè¿”å›<code>undefined</code>ã€‚</p>
<p><code>get</code>æ–¹æ³•å¯ä»¥ç»§æ‰¿ã€‚</p>
<pre><code class="javascript">let proto = new Proxy(&#123;&#125;, &#123;
  get(target, propertyKey, receiver) &#123;
    console.log(&#39;GET &#39; + propertyKey);
    return target[propertyKey];
  &#125;
&#125;);

let obj = Object.create(proto);
obj.foo // &quot;GET foo&quot;</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ‹¦æˆªæ“ä½œå®šä¹‰åœ¨<code>Prototype</code>å¯¹è±¡ä¸Šé¢ï¼Œæ‰€ä»¥å¦‚æœè¯»å–<code>obj</code>å¯¹è±¡ç»§æ‰¿çš„å±æ€§æ—¶ï¼Œæ‹¦æˆªä¼šç”Ÿæ•ˆã€‚</p>
<p>ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨<code>get</code>æ‹¦æˆªï¼Œå®ç°æ•°ç»„è¯»å–è´Ÿæ•°çš„ç´¢å¼•ã€‚</p>
<pre><code class="javascript">function createArray(...elements) &#123;
  let handler = &#123;
    get(target, propKey, receiver) &#123;
      let index = Number(propKey);
      if (index &lt; 0) &#123;
        propKey = String(target.length + index);
      &#125;
      return Reflect.get(target, propKey, receiver);
    &#125;
  &#125;;

  let target = [];
  target.push(...elements);
  return new Proxy(target, handler);
&#125;

let arr = createArray(&#39;a&#39;, &#39;b&#39;, &#39;c&#39;);
arr[-1] // c</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°ç»„çš„ä½ç½®å‚æ•°æ˜¯<code>-1</code>ï¼Œå°±ä¼šè¾“å‡ºæ•°ç»„çš„å€’æ•°ç¬¬ä¸€ä¸ªæˆå‘˜ã€‚</p>
<p>åˆ©ç”¨ Proxyï¼Œå¯ä»¥å°†è¯»å–å±æ€§çš„æ“ä½œï¼ˆ<code>get</code>ï¼‰ï¼Œè½¬å˜ä¸ºæ‰§è¡ŒæŸä¸ªå‡½æ•°ï¼Œä»è€Œå®ç°å±æ€§çš„é“¾å¼æ“ä½œã€‚</p>
<pre><code class="javascript">var pipe = function (value) &#123;
  var funcStack = [];
  var oproxy = new Proxy(&#123;&#125; , &#123;
    get : function (pipeObject, fnName) &#123;
      if (fnName === &#39;get&#39;) &#123;
        return funcStack.reduce(function (val, fn) &#123;
          return fn(val);
        &#125;,value);
      &#125;
      funcStack.push(window[fnName]);
      return oproxy;
    &#125;
  &#125;);

  return oproxy;
&#125;

var double = n =&gt; n * 2;
var pow    = n =&gt; n * n;
var reverseInt = n =&gt; n.toString().split(&quot;&quot;).reverse().join(&quot;&quot;) | 0;

pipe(3).double.pow.reverseInt.get; // 63</code></pre>
<p>ä¸Šé¢ä»£ç è®¾ç½® Proxy ä»¥åï¼Œè¾¾åˆ°äº†å°†å‡½æ•°åé“¾å¼ä½¿ç”¨çš„æ•ˆæœã€‚</p>
<p>ä¸‹é¢çš„ä¾‹å­åˆ™æ˜¯åˆ©ç”¨<code>get</code>æ‹¦æˆªï¼Œå®ç°ä¸€ä¸ªç”Ÿæˆå„ç§ DOM èŠ‚ç‚¹çš„é€šç”¨å‡½æ•°<code>dom</code>ã€‚</p>
<pre><code class="javascript">const dom = new Proxy(&#123;&#125;, &#123;
  get(target, property) &#123;
    return function(attrs = &#123;&#125;, ...children) &#123;
      const el = document.createElement(property);
      for (let prop of Object.keys(attrs)) &#123;
        el.setAttribute(prop, attrs[prop]);
      &#125;
      for (let child of children) &#123;
        if (typeof child === &#39;string&#39;) &#123;
          child = document.createTextNode(child);
        &#125;
        el.appendChild(child);
      &#125;
      return el;
    &#125;
  &#125;
&#125;);

const el = dom.div(&#123;&#125;,
  &#39;Hello, my name is &#39;,
  dom.a(&#123;href: &#39;//example.com&#39;&#125;, &#39;Mark&#39;),
  &#39;. I like:&#39;,
  dom.ul(&#123;&#125;,
    dom.li(&#123;&#125;, &#39;The web&#39;),
    dom.li(&#123;&#125;, &#39;Food&#39;),
    dom.li(&#123;&#125;, &#39;â€¦actually that\&#39;s it&#39;)
  )
);

document.body.appendChild(el);</code></pre>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ª<code>get</code>æ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°çš„ä¾‹å­ï¼Œå®ƒæ€»æ˜¯æŒ‡å‘åŸå§‹çš„è¯»æ“ä½œæ‰€åœ¨çš„é‚£ä¸ªå¯¹è±¡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å°±æ˜¯ Proxy å®ä¾‹ã€‚</p>
<pre><code class="javascript">const proxy = new Proxy(&#123;&#125;, &#123;
  get: function(target, key, receiver) &#123;
    return receiver;
  &#125;
&#125;);
proxy.getReceiver === proxy // true</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>proxy</code>å¯¹è±¡çš„<code>getReceiver</code>å±æ€§æ˜¯ç”±<code>proxy</code>å¯¹è±¡æä¾›çš„ï¼Œæ‰€ä»¥<code>receiver</code>æŒ‡å‘<code>proxy</code>å¯¹è±¡ã€‚</p>
<pre><code class="javascript">const proxy = new Proxy(&#123;&#125;, &#123;
  get: function(target, key, receiver) &#123;
    return receiver;
  &#125;
&#125;);

const d = Object.create(proxy);
d.a === d // true</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>d</code>å¯¹è±¡æœ¬èº«æ²¡æœ‰<code>a</code>å±æ€§ï¼Œæ‰€ä»¥è¯»å–<code>d.a</code>çš„æ—¶å€™ï¼Œä¼šå»<code>d</code>çš„åŸå‹<code>proxy</code>å¯¹è±¡æ‰¾ã€‚è¿™æ—¶ï¼Œ<code>receiver</code>å°±æŒ‡å‘<code>d</code>ï¼Œä»£è¡¨åŸå§‹çš„è¯»æ“ä½œæ‰€åœ¨çš„é‚£ä¸ªå¯¹è±¡ã€‚</p>
<p>å¦‚æœä¸€ä¸ªå±æ€§ä¸å¯é…ç½®ï¼ˆconfigurableï¼‰ä¸”ä¸å¯å†™ï¼ˆwritableï¼‰ï¼Œåˆ™ Proxy ä¸èƒ½ä¿®æ”¹è¯¥å±æ€§ï¼Œå¦åˆ™é€šè¿‡ Proxy å¯¹è±¡è®¿é—®è¯¥å±æ€§ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="javascript">const target = Object.defineProperties(&#123;&#125;, &#123;
  foo: &#123;
    value: 123,
    writable: false,
    configurable: false
  &#125;,
&#125;);

const handler = &#123;
  get(target, propKey) &#123;
    return &#39;abc&#39;;
  &#125;
&#125;;

const proxy = new Proxy(target, handler);

proxy.foo
// TypeError: Invariant check failed</code></pre>
<h3 id="set"><a href="#set" class="headerlink" title="set()"></a>set()</h3><p><code>set</code>æ–¹æ³•ç”¨æ¥æ‹¦æˆªæŸä¸ªå±æ€§çš„èµ‹å€¼æ“ä½œï¼Œå¯ä»¥æ¥å—å››ä¸ªå‚æ•°ï¼Œä¾æ¬¡ä¸ºç›®æ ‡å¯¹è±¡ã€å±æ€§åã€å±æ€§å€¼å’Œ Proxy å®ä¾‹æœ¬èº«ï¼Œå…¶ä¸­æœ€åä¸€ä¸ªå‚æ•°å¯é€‰ã€‚</p>
<p>å‡å®š<code>Person</code>å¯¹è±¡æœ‰ä¸€ä¸ª<code>age</code>å±æ€§ï¼Œè¯¥å±æ€§åº”è¯¥æ˜¯ä¸€ä¸ªä¸å¤§äº 200 çš„æ•´æ•°ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨<code>Proxy</code>ä¿è¯<code>age</code>çš„å±æ€§å€¼ç¬¦åˆè¦æ±‚ã€‚</p>
<pre><code class="javascript">let validator = &#123;
  set: function(obj, prop, value) &#123;
    if (prop === &#39;age&#39;) &#123;
      if (!Number.isInteger(value)) &#123;
        throw new TypeError(&#39;The age is not an integer&#39;);
      &#125;
      if (value &gt; 200) &#123;
        throw new RangeError(&#39;The age seems invalid&#39;);
      &#125;
    &#125;

    // å¯¹äºæ»¡è¶³æ¡ä»¶çš„ age å±æ€§ä»¥åŠå…¶ä»–å±æ€§ï¼Œç›´æ¥ä¿å­˜
    obj[prop] = value;
  &#125;
&#125;;

let person = new Proxy(&#123;&#125;, validator);

person.age = 100;

person.age // 100
person.age = &#39;young&#39; // æŠ¥é”™
person.age = 300 // æŠ¥é”™</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œç”±äºè®¾ç½®äº†å­˜å€¼å‡½æ•°<code>set</code>ï¼Œä»»ä½•ä¸ç¬¦åˆè¦æ±‚çš„<code>age</code>å±æ€§èµ‹å€¼ï¼Œéƒ½ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¿™æ˜¯æ•°æ®éªŒè¯çš„ä¸€ç§å®ç°æ–¹æ³•ã€‚åˆ©ç”¨<code>set</code>æ–¹æ³•ï¼Œè¿˜å¯ä»¥æ•°æ®ç»‘å®šï¼Œå³æ¯å½“å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šè‡ªåŠ¨æ›´æ–° DOMã€‚</p>
<p>æœ‰æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨å¯¹è±¡ä¸Šé¢è®¾ç½®å†…éƒ¨å±æ€§ï¼Œå±æ€§åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä½¿ç”¨ä¸‹åˆ’çº¿å¼€å¤´ï¼Œè¡¨ç¤ºè¿™äº›å±æ€§ä¸åº”è¯¥è¢«å¤–éƒ¨ä½¿ç”¨ã€‚ç»“åˆ<code>get</code>å’Œ<code>set</code>æ–¹æ³•ï¼Œå°±å¯ä»¥åšåˆ°é˜²æ­¢è¿™äº›å†…éƒ¨å±æ€§è¢«å¤–éƒ¨è¯»å†™ã€‚</p>
<pre><code class="javascript">const handler = &#123;
  get (target, key) &#123;
    invariant(key, &#39;get&#39;);
    return target[key];
  &#125;,
  set (target, key, value) &#123;
    invariant(key, &#39;set&#39;);
    target[key] = value;
    return true;
  &#125;
&#125;;
function invariant (key, action) &#123;
  if (key[0] === &#39;_&#39;) &#123;
    throw new Error(`Invalid attempt to $&#123;action&#125; private &quot;$&#123;key&#125;&quot; property`);
  &#125;
&#125;
const target = &#123;&#125;;
const proxy = new Proxy(target, handler);
proxy._prop
// Error: Invalid attempt to get private &quot;_prop&quot; property
proxy._prop = &#39;c&#39;
// Error: Invalid attempt to set private &quot;_prop&quot; property</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œåªè¦è¯»å†™çš„å±æ€§åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸‹åˆ’çº¿ï¼Œä¸€å¾‹æŠ›é”™ï¼Œä»è€Œè¾¾åˆ°ç¦æ­¢è¯»å†™å†…éƒ¨å±æ€§çš„ç›®çš„ã€‚</p>
<p>ä¸‹é¢æ˜¯<code>set</code>æ–¹æ³•ç¬¬å››ä¸ªå‚æ•°çš„ä¾‹å­ã€‚</p>
<pre><code class="javascript">const handler = &#123;
  set: function(obj, prop, value, receiver) &#123;
    obj[prop] = receiver;
  &#125;
&#125;;
const proxy = new Proxy(&#123;&#125;, handler);
proxy.foo = &#39;bar&#39;;
proxy.foo === proxy // true</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>set</code>æ–¹æ³•çš„ç¬¬å››ä¸ªå‚æ•°<code>receiver</code>ï¼ŒæŒ‡çš„æ˜¯åŸå§‹çš„æ“ä½œè¡Œä¸ºæ‰€åœ¨çš„é‚£ä¸ªå¯¹è±¡ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯<code>proxy</code>å®ä¾‹æœ¬èº«ï¼Œè¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚</p>
<pre><code class="javascript">const handler = &#123;
  set: function(obj, prop, value, receiver) &#123;
    obj[prop] = receiver;
  &#125;
&#125;;
const proxy = new Proxy(&#123;&#125;, handler);
const myObj = &#123;&#125;;
Object.setPrototypeOf(myObj, proxy);

myObj.foo = &#39;bar&#39;;
myObj.foo === myObj // true</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œè®¾ç½®<code>myObj.foo</code>å±æ€§çš„å€¼æ—¶ï¼Œ<code>myObj</code>å¹¶æ²¡æœ‰<code>foo</code>å±æ€§ï¼Œå› æ­¤å¼•æ“ä¼šåˆ°<code>myObj</code>çš„åŸå‹é“¾å»æ‰¾<code>foo</code>å±æ€§ã€‚<code>myObj</code>çš„åŸå‹å¯¹è±¡<code>proxy</code>æ˜¯ä¸€ä¸ª Proxy å®ä¾‹ï¼Œè®¾ç½®å®ƒçš„<code>foo</code>å±æ€§ä¼šè§¦å‘<code>set</code>æ–¹æ³•ã€‚è¿™æ—¶ï¼Œç¬¬å››ä¸ªå‚æ•°<code>receiver</code>å°±æŒ‡å‘åŸå§‹èµ‹å€¼è¡Œä¸ºæ‰€åœ¨çš„å¯¹è±¡<code>myObj</code>ã€‚</p>
<p>æ³¨æ„ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡è‡ªèº«çš„æŸä¸ªå±æ€§ä¸å¯å†™ï¼Œé‚£ä¹ˆ<code>set</code>æ–¹æ³•å°†ä¸èµ·ä½œç”¨ã€‚</p>
<pre><code class="javascript">const obj = &#123;&#125;;
Object.defineProperty(obj, &#39;foo&#39;, &#123;
  value: &#39;bar&#39;,
  writable: false
&#125;);

const handler = &#123;
  set: function(obj, prop, value, receiver) &#123;
    obj[prop] = &#39;baz&#39;;
  &#125;
&#125;;

const proxy = new Proxy(obj, handler);
proxy.foo = &#39;baz&#39;;
proxy.foo // &quot;bar&quot;</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>obj.foo</code>å±æ€§ä¸å¯å†™ï¼ŒProxy å¯¹è¿™ä¸ªå±æ€§çš„<code>set</code>ä»£ç†å°†ä¸ä¼šç”Ÿæ•ˆã€‚</p>
<p>æ³¨æ„ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œ<code>set</code>ä»£ç†å¦‚æœæ²¡æœ‰è¿”å›<code>true</code>ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="javascript">&#39;use strict&#39;;
const handler = &#123;
  set: function(obj, prop, value, receiver) &#123;
    obj[prop] = receiver;
    // æ— è®ºæœ‰æ²¡æœ‰ä¸‹é¢è¿™ä¸€è¡Œï¼Œéƒ½ä¼šæŠ¥é”™
    return false;
  &#125;
&#125;;
const proxy = new Proxy(&#123;&#125;, handler);
proxy.foo = &#39;bar&#39;;
// TypeError: &#39;set&#39; on proxy: trap returned falsish for property &#39;foo&#39;</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œ<code>set</code>ä»£ç†è¿”å›<code>false</code>æˆ–è€…<code>undefined</code>ï¼Œéƒ½ä¼šæŠ¥é”™ã€‚</p>
<h3 id="apply"><a href="#apply" class="headerlink" title="apply()"></a>apply()</h3><p><code>apply</code>æ–¹æ³•æ‹¦æˆªå‡½æ•°çš„è°ƒç”¨ã€<code>call</code>å’Œ<code>apply</code>æ“ä½œã€‚</p>
<p><code>apply</code>æ–¹æ³•å¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ç›®æ ‡å¯¹è±¡ã€ç›®æ ‡å¯¹è±¡çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆ<code>this</code>ï¼‰å’Œç›®æ ‡å¯¹è±¡çš„å‚æ•°æ•°ç»„ã€‚</p>
<pre><code class="javascript">var handler = &#123;
  apply (target, ctx, args) &#123;
    return Reflect.apply(...arguments);
  &#125;
&#125;;</code></pre>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p>
<pre><code class="javascript">var target = function () &#123; return &#39;I am the target&#39;; &#125;;
var handler = &#123;
  apply: function () &#123;
    return &#39;I am the proxy&#39;;
  &#125;
&#125;;

var p = new Proxy(target, handler);

p()
// &quot;I am the proxy&quot;</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡<code>p</code>æ˜¯ Proxy çš„å®ä¾‹ï¼Œå½“å®ƒä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ï¼ˆ<code>p()</code>ï¼‰ï¼Œå°±ä¼šè¢«<code>apply</code>æ–¹æ³•æ‹¦æˆªï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<p>ä¸‹é¢æ˜¯å¦å¤–ä¸€ä¸ªä¾‹å­ã€‚</p>
<pre><code class="javascript">var twice = &#123;
  apply (target, ctx, args) &#123;
    return Reflect.apply(...arguments) * 2;
  &#125;
&#125;;
function sum (left, right) &#123;
  return left + right;
&#125;;
var proxy = new Proxy(sum, twice);
proxy(1, 2) // 6
proxy.call(null, 5, 6) // 22
proxy.apply(null, [7, 8]) // 30</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ¯å½“æ‰§è¡Œ<code>proxy</code>å‡½æ•°ï¼ˆç›´æ¥è°ƒç”¨æˆ–<code>call</code>å’Œ<code>apply</code>è°ƒç”¨ï¼‰ï¼Œå°±ä¼šè¢«<code>apply</code>æ–¹æ³•æ‹¦æˆªã€‚</p>
<p>å¦å¤–ï¼Œç›´æ¥è°ƒç”¨<code>Reflect.apply</code>æ–¹æ³•ï¼Œä¹Ÿä¼šè¢«æ‹¦æˆªã€‚</p>
<pre><code class="javascript">Reflect.apply(proxy, null, [9, 10]) // 38</code></pre>
<h3 id="has"><a href="#has" class="headerlink" title="has()"></a>has()</h3><p><code>has()</code>æ–¹æ³•ç”¨æ¥æ‹¦æˆª<code>HasProperty</code>æ“ä½œï¼Œå³åˆ¤æ–­å¯¹è±¡æ˜¯å¦å…·æœ‰æŸä¸ªå±æ€§æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šç”Ÿæ•ˆã€‚å…¸å‹çš„æ“ä½œå°±æ˜¯<code>in</code>è¿ç®—ç¬¦ã€‚</p>
<p><code>has()</code>æ–¹æ³•å¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ç›®æ ‡å¯¹è±¡ã€éœ€æŸ¥è¯¢çš„å±æ€§åã€‚</p>
<p>ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨<code>has()</code>æ–¹æ³•éšè—æŸäº›å±æ€§ï¼Œä¸è¢«<code>in</code>è¿ç®—ç¬¦å‘ç°ã€‚</p>
<pre><code class="javascript">var handler = &#123;
  has (target, key) &#123;
    if (key[0] === &#39;_&#39;) &#123;
      return false;
    &#125;
    return key in target;
  &#125;
&#125;;
var target = &#123; _prop: &#39;foo&#39;, prop: &#39;foo&#39; &#125;;
var proxy = new Proxy(target, handler);
&#39;_prop&#39; in proxy // false</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œå¦‚æœåŸå¯¹è±¡çš„å±æ€§åçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ä¸‹åˆ’çº¿ï¼Œ<code>proxy.has()</code>å°±ä¼šè¿”å›<code>false</code>ï¼Œä»è€Œä¸ä¼šè¢«<code>in</code>è¿ç®—ç¬¦å‘ç°ã€‚</p>
<p>å¦‚æœåŸå¯¹è±¡ä¸å¯é…ç½®æˆ–è€…ç¦æ­¢æ‰©å±•ï¼Œè¿™æ—¶<code>has()</code>æ‹¦æˆªä¼šæŠ¥é”™ã€‚</p>
<pre><code class="javascript">var obj = &#123; a: 10 &#125;;
Object.preventExtensions(obj);

var p = new Proxy(obj, &#123;
  has: function(target, prop) &#123;
    return false;
  &#125;
&#125;);

&#39;a&#39; in p // TypeError is thrown</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>obj</code>å¯¹è±¡ç¦æ­¢æ‰©å±•ï¼Œç»“æœä½¿ç”¨<code>has</code>æ‹¦æˆªå°±ä¼šæŠ¥é”™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŸä¸ªå±æ€§ä¸å¯é…ç½®ï¼ˆæˆ–è€…ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼‰ï¼Œåˆ™<code>has()</code>æ–¹æ³•å°±ä¸å¾—â€œéšè—â€ï¼ˆå³è¿”å›<code>false</code>ï¼‰ç›®æ ‡å¯¹è±¡çš„è¯¥å±æ€§ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>has()</code>æ–¹æ³•æ‹¦æˆªçš„æ˜¯<code>HasProperty</code>æ“ä½œï¼Œè€Œä¸æ˜¯<code>HasOwnProperty</code>æ“ä½œï¼Œå³<code>has()</code>æ–¹æ³•ä¸åˆ¤æ–­ä¸€ä¸ªå±æ€§æ˜¯å¯¹è±¡è‡ªèº«çš„å±æ€§ï¼Œè¿˜æ˜¯ç»§æ‰¿çš„å±æ€§ã€‚</p>
<p>å¦å¤–ï¼Œè™½ç„¶<code>for...in</code>å¾ªç¯ä¹Ÿç”¨åˆ°äº†<code>in</code>è¿ç®—ç¬¦ï¼Œä½†æ˜¯<code>has()</code>æ‹¦æˆªå¯¹<code>for...in</code>å¾ªç¯ä¸ç”Ÿæ•ˆã€‚</p>
<pre><code class="javascript">let stu1 = &#123;name: &#39;å¼ ä¸‰&#39;, score: 59&#125;;
let stu2 = &#123;name: &#39;æå››&#39;, score: 99&#125;;

let handler = &#123;
  has(target, prop) &#123;
    if (prop === &#39;score&#39; &amp;&amp; target[prop] &lt; 60) &#123;
      console.log(`$&#123;target.name&#125; ä¸åŠæ ¼`);
      return false;
    &#125;
    return prop in target;
  &#125;
&#125;

let oproxy1 = new Proxy(stu1, handler);
let oproxy2 = new Proxy(stu2, handler);

&#39;score&#39; in oproxy1
// å¼ ä¸‰ ä¸åŠæ ¼
// false

&#39;score&#39; in oproxy2
// true

for (let a in oproxy1) &#123;
  console.log(oproxy1[a]);
&#125;
// å¼ ä¸‰
// 59

for (let b in oproxy2) &#123;
  console.log(oproxy2[b]);
&#125;
// æå››
// 99</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>has()</code>æ‹¦æˆªåªå¯¹<code>in</code>è¿ç®—ç¬¦ç”Ÿæ•ˆï¼Œå¯¹<code>for...in</code>å¾ªç¯ä¸ç”Ÿæ•ˆï¼Œå¯¼è‡´ä¸ç¬¦åˆè¦æ±‚çš„å±æ€§æ²¡æœ‰è¢«<code>for...in</code>å¾ªç¯æ‰€æ’é™¤ã€‚</p>
<h3 id="construct"><a href="#construct" class="headerlink" title="construct()"></a>construct()</h3><p><code>construct()</code>æ–¹æ³•ç”¨äºæ‹¦æˆª<code>new</code>å‘½ä»¤ï¼Œä¸‹é¢æ˜¯æ‹¦æˆªå¯¹è±¡çš„å†™æ³•ã€‚</p>
<pre><code class="javascript">const handler = &#123;
  construct (target, args, newTarget) &#123;
    return new target(...args);
  &#125;
&#125;;</code></pre>
<p><code>construct()</code>æ–¹æ³•å¯ä»¥æ¥å—ä¸‰ä¸ªå‚æ•°ã€‚</p>
<ul>
<li><code>target</code>ï¼šç›®æ ‡å¯¹è±¡ã€‚</li>
<li><code>args</code>ï¼šæ„é€ å‡½æ•°çš„å‚æ•°æ•°ç»„ã€‚</li>
<li><code>newTarget</code>ï¼šåˆ›é€ å®ä¾‹å¯¹è±¡æ—¶ï¼Œ<code>new</code>å‘½ä»¤ä½œç”¨çš„æ„é€ å‡½æ•°ï¼ˆä¸‹é¢ä¾‹å­çš„<code>p</code>ï¼‰ã€‚</li>
</ul>
<pre><code class="javascript">const p = new Proxy(function () &#123;&#125;, &#123;
  construct: function(target, args) &#123;
    console.log(&#39;called: &#39; + args.join(&#39;, &#39;));
    return &#123; value: args[0] * 10 &#125;;
  &#125;
&#125;);

(new p(1)).value
// &quot;called: 1&quot;
// 10</code></pre>
<p><code>construct()</code>æ–¹æ³•è¿”å›çš„å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="javascript">const p = new Proxy(function() &#123;&#125;, &#123;
  construct: function(target, argumentsList) &#123;
    return 1;
  &#125;
&#125;);

new p() // æŠ¥é”™
// Uncaught TypeError: &#39;construct&#39; on proxy: trap returned non-object (&#39;1&#39;)</code></pre>
<p>å¦å¤–ï¼Œç”±äº<code>construct()</code>æ‹¦æˆªçš„æ˜¯æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥å®ƒçš„ç›®æ ‡å¯¹è±¡å¿…é¡»æ˜¯å‡½æ•°ï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="javascript">const p = new Proxy(&#123;&#125;, &#123;
  construct: function(target, argumentsList) &#123;
    return &#123;&#125;;
  &#125;
&#125;);

new p() // æŠ¥é”™
// Uncaught TypeError: p is not a constructor</code></pre>
<p>ä¸Šé¢ä¾‹å­ä¸­ï¼Œæ‹¦æˆªçš„ç›®æ ‡å¯¹è±¡ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆ<code>new Proxy()</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ï¼Œå¯¼è‡´æŠ¥é”™ã€‚</p>
<p>æ³¨æ„ï¼Œ<code>construct()</code>æ–¹æ³•ä¸­çš„<code>this</code>æŒ‡å‘çš„æ˜¯<code>handler</code>ï¼Œè€Œä¸æ˜¯å®ä¾‹å¯¹è±¡ã€‚</p>
<pre><code class="javascript">const handler = &#123;
  construct: function(target, args) &#123;
    console.log(this === handler);
    return new target(...args);
  &#125;
&#125;

let p = new Proxy(function () &#123;&#125;, handler);
new p() // true</code></pre>
<h3 id="deleteProperty"><a href="#deleteProperty" class="headerlink" title="deleteProperty()"></a>deleteProperty()</h3><p><code>deleteProperty</code>æ–¹æ³•ç”¨äºæ‹¦æˆª<code>delete</code>æ“ä½œï¼Œå¦‚æœè¿™ä¸ªæ–¹æ³•æŠ›å‡ºé”™è¯¯æˆ–è€…è¿”å›<code>false</code>ï¼Œå½“å‰å±æ€§å°±æ— æ³•è¢«<code>delete</code>å‘½ä»¤åˆ é™¤ã€‚</p>
<pre><code class="javascript">var handler = &#123;
  deleteProperty (target, key) &#123;
    invariant(key, &#39;delete&#39;);
    delete target[key];
    return true;
  &#125;
&#125;;
function invariant (key, action) &#123;
  if (key[0] === &#39;_&#39;) &#123;
    throw new Error(`Invalid attempt to $&#123;action&#125; private &quot;$&#123;key&#125;&quot; property`);
  &#125;
&#125;

var target = &#123; _prop: &#39;foo&#39; &#125;;
var proxy = new Proxy(target, handler);
delete proxy._prop
// Error: Invalid attempt to delete private &quot;_prop&quot; property</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>deleteProperty</code>æ–¹æ³•æ‹¦æˆªäº†<code>delete</code>æ“ä½œç¬¦ï¼Œåˆ é™¤ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºä¸‹åˆ’çº¿çš„å±æ€§ä¼šæŠ¥é”™ã€‚</p>
<p>æ³¨æ„ï¼Œç›®æ ‡å¯¹è±¡è‡ªèº«çš„ä¸å¯é…ç½®ï¼ˆconfigurableï¼‰çš„å±æ€§ï¼Œä¸èƒ½è¢«<code>deleteProperty</code>æ–¹æ³•åˆ é™¤ï¼Œå¦åˆ™æŠ¥é”™ã€‚</p>
<h3 id="defineProperty"><a href="#defineProperty" class="headerlink" title="defineProperty()"></a>defineProperty()</h3><p><code>defineProperty()</code>æ–¹æ³•æ‹¦æˆªäº†<code>Object.defineProperty()</code>æ“ä½œã€‚</p>
<pre><code class="javascript">var handler = &#123;
  defineProperty (target, key, descriptor) &#123;
    return false;
  &#125;
&#125;;
var target = &#123;&#125;;
var proxy = new Proxy(target, handler);
proxy.foo = &#39;bar&#39; // ä¸ä¼šç”Ÿæ•ˆ</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>defineProperty()</code>æ–¹æ³•å†…éƒ¨æ²¡æœ‰ä»»ä½•æ“ä½œï¼Œåªè¿”å›<code>false</code>ï¼Œå¯¼è‡´æ·»åŠ æ–°å±æ€§æ€»æ˜¯æ— æ•ˆã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„<code>false</code>åªæ˜¯ç”¨æ¥æç¤ºæ“ä½œå¤±è´¥ï¼Œæœ¬èº«å¹¶ä¸èƒ½é˜»æ­¢æ·»åŠ æ–°å±æ€§ã€‚</p>
<p>æ³¨æ„ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼ˆnon-extensibleï¼‰ï¼Œåˆ™<code>defineProperty()</code>ä¸èƒ½å¢åŠ ç›®æ ‡å¯¹è±¡ä¸Šä¸å­˜åœ¨çš„å±æ€§ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚å¦å¤–ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡çš„æŸä¸ªå±æ€§ä¸å¯å†™ï¼ˆwritableï¼‰æˆ–ä¸å¯é…ç½®ï¼ˆconfigurableï¼‰ï¼Œåˆ™<code>defineProperty()</code>æ–¹æ³•ä¸å¾—æ”¹å˜è¿™ä¸¤ä¸ªè®¾ç½®ã€‚</p>
<h3 id="getOwnPropertyDescriptor"><a href="#getOwnPropertyDescriptor" class="headerlink" title="getOwnPropertyDescriptor()"></a>getOwnPropertyDescriptor()</h3><p><code>getOwnPropertyDescriptor()</code>æ–¹æ³•æ‹¦æˆª<code>Object.getOwnPropertyDescriptor()</code>ï¼Œè¿”å›ä¸€ä¸ªå±æ€§æè¿°å¯¹è±¡æˆ–è€…<code>undefined</code>ã€‚</p>
<pre><code class="javascript">var handler = &#123;
  getOwnPropertyDescriptor (target, key) &#123;
    if (key[0] === &#39;_&#39;) &#123;
      return;
    &#125;
    return Object.getOwnPropertyDescriptor(target, key);
  &#125;
&#125;;
var target = &#123; _foo: &#39;bar&#39;, baz: &#39;tar&#39; &#125;;
var proxy = new Proxy(target, handler);
Object.getOwnPropertyDescriptor(proxy, &#39;wat&#39;)
// undefined
Object.getOwnPropertyDescriptor(proxy, &#39;_foo&#39;)
// undefined
Object.getOwnPropertyDescriptor(proxy, &#39;baz&#39;)
// &#123; value: &#39;tar&#39;, writable: true, enumerable: true, configurable: true &#125;</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>handler.getOwnPropertyDescriptor()</code>æ–¹æ³•å¯¹äºç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºä¸‹åˆ’çº¿çš„å±æ€§åä¼šè¿”å›<code>undefined</code>ã€‚</p>
<h3 id="getPrototypeOf"><a href="#getPrototypeOf" class="headerlink" title="getPrototypeOf()"></a>getPrototypeOf()</h3><p><code>getPrototypeOf()</code>æ–¹æ³•ä¸»è¦ç”¨æ¥æ‹¦æˆªè·å–å¯¹è±¡åŸå‹ã€‚å…·ä½“æ¥è¯´ï¼Œæ‹¦æˆªä¸‹é¢è¿™äº›æ“ä½œã€‚</p>
<ul>
<li><code>Object.prototype.__proto__</code></li>
<li><code>Object.prototype.isPrototypeOf()</code></li>
<li><code>Object.getPrototypeOf()</code></li>
<li><code>Reflect.getPrototypeOf()</code></li>
<li><code>instanceof</code></li>
</ul>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p>
<pre><code class="javascript">var proto = &#123;&#125;;
var p = new Proxy(&#123;&#125;, &#123;
  getPrototypeOf(target) &#123;
    return proto;
  &#125;
&#125;);
Object.getPrototypeOf(p) === proto // true</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>getPrototypeOf()</code>æ–¹æ³•æ‹¦æˆª<code>Object.getPrototypeOf()</code>ï¼Œè¿”å›<code>proto</code>å¯¹è±¡ã€‚</p>
<p>æ³¨æ„ï¼Œ<code>getPrototypeOf()</code>æ–¹æ³•çš„è¿”å›å€¼å¿…é¡»æ˜¯å¯¹è±¡æˆ–è€…<code>null</code>ï¼Œå¦åˆ™æŠ¥é”™ã€‚å¦å¤–ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼ˆnon-extensibleï¼‰ï¼Œ <code>getPrototypeOf()</code>æ–¹æ³•å¿…é¡»è¿”å›ç›®æ ‡å¯¹è±¡çš„åŸå‹å¯¹è±¡ã€‚</p>
<h3 id="isExtensible"><a href="#isExtensible" class="headerlink" title="isExtensible()"></a>isExtensible()</h3><p><code>isExtensible()</code>æ–¹æ³•æ‹¦æˆª<code>Object.isExtensible()</code>æ“ä½œã€‚</p>
<pre><code class="javascript">var p = new Proxy(&#123;&#125;, &#123;
  isExtensible: function(target) &#123;
    console.log(&quot;called&quot;);
    return true;
  &#125;
&#125;);

Object.isExtensible(p)
// &quot;called&quot;
// true</code></pre>
<p>ä¸Šé¢ä»£ç è®¾ç½®äº†<code>isExtensible()</code>æ–¹æ³•ï¼Œåœ¨è°ƒç”¨<code>Object.isExtensible</code>æ—¶ä¼šè¾“å‡º<code>called</code>ã€‚</p>
<p>æ³¨æ„ï¼Œè¯¥æ–¹æ³•åªèƒ½è¿”å›å¸ƒå°”å€¼ï¼Œå¦åˆ™è¿”å›å€¼ä¼šè¢«è‡ªåŠ¨è½¬ä¸ºå¸ƒå°”å€¼ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªå¼ºé™åˆ¶ï¼Œå®ƒçš„è¿”å›å€¼å¿…é¡»ä¸ç›®æ ‡å¯¹è±¡çš„<code>isExtensible</code>å±æ€§ä¿æŒä¸€è‡´ï¼Œå¦åˆ™å°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚</p>
<pre><code class="javascript">Object.isExtensible(proxy) === Object.isExtensible(target)</code></pre>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p>
<pre><code class="javascript">var p = new Proxy(&#123;&#125;, &#123;
  isExtensible: function(target) &#123;
    return false;
  &#125;
&#125;);

Object.isExtensible(p)
// Uncaught TypeError: &#39;isExtensible&#39; on proxy: trap result does not reflect extensibility of proxy target (which is &#39;true&#39;)</code></pre>
<h3 id="ownKeys"><a href="#ownKeys" class="headerlink" title="ownKeys()"></a>ownKeys()</h3><p><code>ownKeys()</code>æ–¹æ³•ç”¨æ¥æ‹¦æˆªå¯¹è±¡è‡ªèº«å±æ€§çš„è¯»å–æ“ä½œã€‚å…·ä½“æ¥è¯´ï¼Œæ‹¦æˆªä»¥ä¸‹æ“ä½œã€‚</p>
<ul>
<li><code>Object.getOwnPropertyNames()</code></li>
<li><code>Object.getOwnPropertySymbols()</code></li>
<li><code>Object.keys()</code></li>
<li><code>for...in</code>å¾ªç¯</li>
</ul>
<p>ä¸‹é¢æ˜¯æ‹¦æˆª<code>Object.keys()</code>çš„ä¾‹å­ã€‚</p>
<pre><code class="javascript">let target = &#123;
  a: 1,
  b: 2,
  c: 3
&#125;;

let handler = &#123;
  ownKeys(target) &#123;
    return [&#39;a&#39;];
  &#125;
&#125;;

let proxy = new Proxy(target, handler);

Object.keys(proxy)
// [ &#39;a&#39; ]</code></pre>
<p>ä¸Šé¢ä»£ç æ‹¦æˆªäº†å¯¹äº<code>target</code>å¯¹è±¡çš„<code>Object.keys()</code>æ“ä½œï¼Œåªè¿”å›<code>a</code>ã€<code>b</code>ã€<code>c</code>ä¸‰ä¸ªå±æ€§ä¹‹ä¸­çš„<code>a</code>å±æ€§ã€‚</p>
<p>ä¸‹é¢çš„ä¾‹å­æ˜¯æ‹¦æˆªç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºä¸‹åˆ’çº¿çš„å±æ€§åã€‚</p>
<pre><code class="javascript">let target = &#123;
  _bar: &#39;foo&#39;,
  _prop: &#39;bar&#39;,
  prop: &#39;baz&#39;
&#125;;

let handler = &#123;
  ownKeys (target) &#123;
    return Reflect.ownKeys(target).filter(key =&gt; key[0] !== &#39;_&#39;);
  &#125;
&#125;;

let proxy = new Proxy(target, handler);
for (let key of Object.keys(proxy)) &#123;
  console.log(target[key]);
&#125;
// &quot;baz&quot;</code></pre>
<p>æ³¨æ„ï¼Œä½¿ç”¨<code>Object.keys()</code>æ–¹æ³•æ—¶ï¼Œæœ‰ä¸‰ç±»å±æ€§ä¼šè¢«<code>ownKeys()</code>æ–¹æ³•è‡ªåŠ¨è¿‡æ»¤ï¼Œä¸ä¼šè¿”å›ã€‚</p>
<ul>
<li>ç›®æ ‡å¯¹è±¡ä¸Šä¸å­˜åœ¨çš„å±æ€§</li>
<li>å±æ€§åä¸º Symbol å€¼</li>
<li>ä¸å¯éå†ï¼ˆ<code>enumerable</code>ï¼‰çš„å±æ€§</li>
</ul>
<pre><code class="javascript">let target = &#123;
  a: 1,
  b: 2,
  c: 3,
  [Symbol.for(&#39;secret&#39;)]: &#39;4&#39;,
&#125;;

Object.defineProperty(target, &#39;key&#39;, &#123;
  enumerable: false,
  configurable: true,
  writable: true,
  value: &#39;static&#39;
&#125;);

let handler = &#123;
  ownKeys(target) &#123;
    return [&#39;a&#39;, &#39;d&#39;, Symbol.for(&#39;secret&#39;), &#39;key&#39;];
  &#125;
&#125;;

let proxy = new Proxy(target, handler);

Object.keys(proxy)
// [&#39;a&#39;]</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>ownKeys()</code>æ–¹æ³•ä¹‹ä¸­ï¼Œæ˜¾å¼è¿”å›ä¸å­˜åœ¨çš„å±æ€§ï¼ˆ<code>d</code>ï¼‰ã€Symbol å€¼ï¼ˆ<code>Symbol.for(&#39;secret&#39;)</code>ï¼‰ã€ä¸å¯éå†çš„å±æ€§ï¼ˆ<code>key</code>ï¼‰ï¼Œç»“æœéƒ½è¢«è‡ªåŠ¨è¿‡æ»¤æ‰ã€‚</p>
<p><code>ownKeys()</code>æ–¹æ³•è¿˜å¯ä»¥æ‹¦æˆª<code>Object.getOwnPropertyNames()</code>ã€‚</p>
<pre><code class="javascript">var p = new Proxy(&#123;&#125;, &#123;
  ownKeys: function(target) &#123;
    return [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;];
  &#125;
&#125;);

Object.getOwnPropertyNames(p)
// [ &#39;a&#39;, &#39;b&#39;, &#39;c&#39; ]</code></pre>
<p><code>for...in</code>å¾ªç¯ä¹Ÿå—åˆ°<code>ownKeys()</code>æ–¹æ³•çš„æ‹¦æˆªã€‚</p>
<pre><code class="javascript">const obj = &#123; hello: &#39;world&#39; &#125;;
const proxy = new Proxy(obj, &#123;
  ownKeys: function () &#123;
    return [&#39;a&#39;, &#39;b&#39;];
  &#125;
&#125;);

for (let key in proxy) &#123;
  console.log(key); // æ²¡æœ‰ä»»ä½•è¾“å‡º
&#125;</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>ownkeys()</code>æŒ‡å®šåªè¿”å›<code>a</code>å’Œ<code>b</code>å±æ€§ï¼Œç”±äº<code>obj</code>æ²¡æœ‰è¿™ä¸¤ä¸ªå±æ€§ï¼Œå› æ­¤<code>for...in</code>å¾ªç¯ä¸ä¼šæœ‰ä»»ä½•è¾“å‡ºã€‚</p>
<p><code>ownKeys()</code>æ–¹æ³•è¿”å›çš„æ•°ç»„æˆå‘˜ï¼Œåªèƒ½æ˜¯å­—ç¬¦ä¸²æˆ– Symbol å€¼ã€‚å¦‚æœæœ‰å…¶ä»–ç±»å‹çš„å€¼ï¼Œæˆ–è€…è¿”å›çš„æ ¹æœ¬ä¸æ˜¯æ•°ç»„ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="javascript">var obj = &#123;&#125;;

var p = new Proxy(obj, &#123;
  ownKeys: function(target) &#123;
    return [123, true, undefined, null, &#123;&#125;, []];
  &#125;
&#125;);

Object.getOwnPropertyNames(p)
// Uncaught TypeError: 123 is not a valid property name</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>ownKeys()</code>æ–¹æ³•è™½ç„¶è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªæ•°ç»„æˆå‘˜éƒ½ä¸æ˜¯å­—ç¬¦ä¸²æˆ– Symbol å€¼ï¼Œå› æ­¤å°±æŠ¥é”™äº†ã€‚</p>
<p>å¦‚æœç›®æ ‡å¯¹è±¡è‡ªèº«åŒ…å«ä¸å¯é…ç½®çš„å±æ€§ï¼Œåˆ™è¯¥å±æ€§å¿…é¡»è¢«<code>ownKeys()</code>æ–¹æ³•è¿”å›ï¼Œå¦åˆ™æŠ¥é”™ã€‚</p>
<pre><code class="javascript">var obj = &#123;&#125;;
Object.defineProperty(obj, &#39;a&#39;, &#123;
  configurable: false,
  enumerable: true,
  value: 10 &#125;
);

var p = new Proxy(obj, &#123;
  ownKeys: function(target) &#123;
    return [&#39;b&#39;];
  &#125;
&#125;);

Object.getOwnPropertyNames(p)
// Uncaught TypeError: &#39;ownKeys&#39; on proxy: trap result did not include &#39;a&#39;</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>obj</code>å¯¹è±¡çš„<code>a</code>å±æ€§æ˜¯ä¸å¯é…ç½®çš„ï¼Œè¿™æ—¶<code>ownKeys()</code>æ–¹æ³•è¿”å›çš„æ•°ç»„ä¹‹ä¸­ï¼Œå¿…é¡»åŒ…å«<code>a</code>ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡æ˜¯ä¸å¯æ‰©å±•çš„ï¼ˆnon-extensibleï¼‰ï¼Œè¿™æ—¶<code>ownKeys()</code>æ–¹æ³•è¿”å›çš„æ•°ç»„ä¹‹ä¸­ï¼Œå¿…é¡»åŒ…å«åŸå¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œä¸”ä¸èƒ½åŒ…å«å¤šä½™çš„å±æ€§ï¼Œå¦åˆ™æŠ¥é”™ã€‚</p>
<pre><code class="javascript">var obj = &#123;
  a: 1
&#125;;

Object.preventExtensions(obj);

var p = new Proxy(obj, &#123;
  ownKeys: function(target) &#123;
    return [&#39;a&#39;, &#39;b&#39;];
  &#125;
&#125;);

Object.getOwnPropertyNames(p)
// Uncaught TypeError: &#39;ownKeys&#39; on proxy: trap returned extra keys but proxy target is non-extensible</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>obj</code>å¯¹è±¡æ˜¯ä¸å¯æ‰©å±•çš„ï¼Œè¿™æ—¶<code>ownKeys()</code>æ–¹æ³•è¿”å›çš„æ•°ç»„ä¹‹ä¸­ï¼ŒåŒ…å«äº†<code>obj</code>å¯¹è±¡çš„å¤šä½™å±æ€§<code>b</code>ï¼Œæ‰€ä»¥å¯¼è‡´äº†æŠ¥é”™ã€‚</p>
<h3 id="preventExtensions"><a href="#preventExtensions" class="headerlink" title="preventExtensions()"></a>preventExtensions()</h3><p><code>preventExtensions()</code>æ–¹æ³•æ‹¦æˆª<code>Object.preventExtensions()</code>ã€‚è¯¥æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦åˆ™ä¼šè¢«è‡ªåŠ¨è½¬ä¸ºå¸ƒå°”å€¼ã€‚</p>
<p>è¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œåªæœ‰ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•æ—¶ï¼ˆå³<code>Object.isExtensible(proxy)</code>ä¸º<code>false</code>ï¼‰ï¼Œ<code>proxy.preventExtensions</code>æ‰èƒ½è¿”å›<code>true</code>ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<pre><code class="javascript">var proxy = new Proxy(&#123;&#125;, &#123;
  preventExtensions: function(target) &#123;
    return true;
  &#125;
&#125;);

Object.preventExtensions(proxy)
// Uncaught TypeError: &#39;preventExtensions&#39; on proxy: trap returned truish but the proxy target is extensible</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>proxy.preventExtensions()</code>æ–¹æ³•è¿”å›<code>true</code>ï¼Œä½†è¿™æ—¶<code>Object.isExtensible(proxy)</code>ä¼šè¿”å›<code>true</code>ï¼Œå› æ­¤æŠ¥é”™ã€‚</p>
<p>ä¸ºäº†é˜²æ­¢å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œé€šå¸¸è¦åœ¨<code>proxy.preventExtensions()</code>æ–¹æ³•é‡Œé¢ï¼Œè°ƒç”¨ä¸€æ¬¡<code>Object.preventExtensions()</code>ã€‚</p>
<pre><code class="javascript">var proxy = new Proxy(&#123;&#125;, &#123;
  preventExtensions: function(target) &#123;
    console.log(&#39;called&#39;);
    Object.preventExtensions(target);
    return true;
  &#125;
&#125;);

Object.preventExtensions(proxy)
// &quot;called&quot;
// Proxy &#123;&#125;</code></pre>
<h3 id="setPrototypeOf"><a href="#setPrototypeOf" class="headerlink" title="setPrototypeOf()"></a>setPrototypeOf()</h3><p><code>setPrototypeOf()</code>æ–¹æ³•ä¸»è¦ç”¨æ¥æ‹¦æˆª<code>Object.setPrototypeOf()</code>æ–¹æ³•ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p>
<pre><code class="javascript">var handler = &#123;
  setPrototypeOf (target, proto) &#123;
    throw new Error(&#39;Changing the prototype is forbidden&#39;);
  &#125;
&#125;;
var proto = &#123;&#125;;
var target = function () &#123;&#125;;
var proxy = new Proxy(target, handler);
Object.setPrototypeOf(proxy, proto);
// Error: Changing the prototype is forbidden</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œåªè¦ä¿®æ”¹<code>target</code>çš„åŸå‹å¯¹è±¡ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p>
<p>æ³¨æ„ï¼Œè¯¥æ–¹æ³•åªèƒ½è¿”å›å¸ƒå°”å€¼ï¼Œå¦åˆ™ä¼šè¢«è‡ªåŠ¨è½¬ä¸ºå¸ƒå°”å€¼ã€‚å¦å¤–ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼ˆnon-extensibleï¼‰ï¼Œ<code>setPrototypeOf()</code>æ–¹æ³•ä¸å¾—æ”¹å˜ç›®æ ‡å¯¹è±¡çš„åŸå‹ã€‚</p>
<h2 id="Proxy-revocable"><a href="#Proxy-revocable" class="headerlink" title="Proxy.revocable()"></a>Proxy.revocable()</h2><p><code>Proxy.revocable()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªå¯å–æ¶ˆçš„ Proxy å®ä¾‹ã€‚</p>
<pre><code class="javascript">let target = &#123;&#125;;
let handler = &#123;&#125;;

let &#123;proxy, revoke&#125; = Proxy.revocable(target, handler);

proxy.foo = 123;
proxy.foo // 123

revoke();
proxy.foo // TypeError: Revoked</code></pre>
<p><code>Proxy.revocable()</code>æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„<code>proxy</code>å±æ€§æ˜¯<code>Proxy</code>å®ä¾‹ï¼Œ<code>revoke</code>å±æ€§æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥å–æ¶ˆ<code>Proxy</code>å®ä¾‹ã€‚ä¸Šé¢ä»£ç ä¸­ï¼Œå½“æ‰§è¡Œ<code>revoke</code>å‡½æ•°ä¹‹åï¼Œå†è®¿é—®<code>Proxy</code>å®ä¾‹ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p>
<p><code>Proxy.revocable()</code>çš„ä¸€ä¸ªä½¿ç”¨åœºæ™¯æ˜¯ï¼Œç›®æ ‡å¯¹è±¡ä¸å…è®¸ç›´æ¥è®¿é—®ï¼Œå¿…é¡»é€šè¿‡ä»£ç†è®¿é—®ï¼Œä¸€æ—¦è®¿é—®ç»“æŸï¼Œå°±æ”¶å›ä»£ç†æƒï¼Œä¸å…è®¸å†æ¬¡è®¿é—®ã€‚</p>
<h2 id="this-é—®é¢˜"><a href="#this-é—®é¢˜" class="headerlink" title="this é—®é¢˜"></a>this é—®é¢˜</h2><p>è™½ç„¶ Proxy å¯ä»¥ä»£ç†é’ˆå¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ï¼Œä½†å®ƒä¸æ˜¯ç›®æ ‡å¯¹è±¡çš„é€æ˜ä»£ç†ï¼Œå³ä¸åšä»»ä½•æ‹¦æˆªçš„æƒ…å†µä¸‹ï¼Œä¹Ÿæ— æ³•ä¿è¯ä¸ç›®æ ‡å¯¹è±¡çš„è¡Œä¸ºä¸€è‡´ã€‚ä¸»è¦åŸå› å°±æ˜¯åœ¨ Proxy ä»£ç†çš„æƒ…å†µä¸‹ï¼Œç›®æ ‡å¯¹è±¡å†…éƒ¨çš„<code>this</code>å…³é”®å­—ä¼šæŒ‡å‘ Proxy ä»£ç†ã€‚</p>
<pre><code class="javascript">const target = &#123;
  m: function () &#123;
    console.log(this === proxy);
  &#125;
&#125;;
const handler = &#123;&#125;;

const proxy = new Proxy(target, handler);

target.m() // false
proxy.m()  // true</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œä¸€æ—¦<code>proxy</code>ä»£ç†<code>target</code>ï¼Œ<code>target.m()</code>å†…éƒ¨çš„<code>this</code>å°±æ˜¯æŒ‡å‘<code>proxy</code>ï¼Œè€Œä¸æ˜¯<code>target</code>ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œç”±äº<code>this</code>æŒ‡å‘çš„å˜åŒ–ï¼Œå¯¼è‡´ Proxy æ— æ³•ä»£ç†ç›®æ ‡å¯¹è±¡ã€‚</p>
<pre><code class="javascript">const _name = new WeakMap();

class Person &#123;
  constructor(name) &#123;
    _name.set(this, name);
  &#125;
  get name() &#123;
    return _name.get(this);
  &#125;
&#125;

const jane = new Person(&#39;Jane&#39;);
jane.name // &#39;Jane&#39;

const proxy = new Proxy(jane, &#123;&#125;);
proxy.name // undefined</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œç›®æ ‡å¯¹è±¡<code>jane</code>çš„<code>name</code>å±æ€§ï¼Œå®é™…ä¿å­˜åœ¨å¤–éƒ¨<code>WeakMap</code>å¯¹è±¡<code>_name</code>ä¸Šé¢ï¼Œé€šè¿‡<code>this</code>é”®åŒºåˆ†ã€‚ç”±äºé€šè¿‡<code>proxy.name</code>è®¿é—®æ—¶ï¼Œ<code>this</code>æŒ‡å‘<code>proxy</code>ï¼Œå¯¼è‡´æ— æ³•å–åˆ°å€¼ï¼Œæ‰€ä»¥è¿”å›<code>undefined</code>ã€‚</p>
<p>æ­¤å¤–ï¼Œæœ‰äº›åŸç”Ÿå¯¹è±¡çš„å†…éƒ¨å±æ€§ï¼Œåªæœ‰é€šè¿‡æ­£ç¡®çš„<code>this</code>æ‰èƒ½æ‹¿åˆ°ï¼Œæ‰€ä»¥ Proxy ä¹Ÿæ— æ³•ä»£ç†è¿™äº›åŸç”Ÿå¯¹è±¡çš„å±æ€§ã€‚</p>
<pre><code class="javascript">const target = new Date();
const handler = &#123;&#125;;
const proxy = new Proxy(target, handler);

proxy.getDate();
// TypeError: this is not a Date object.</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œ<code>getDate()</code>æ–¹æ³•åªèƒ½åœ¨<code>Date</code>å¯¹è±¡å®ä¾‹ä¸Šé¢æ‹¿åˆ°ï¼Œå¦‚æœ<code>this</code>ä¸æ˜¯<code>Date</code>å¯¹è±¡å®ä¾‹å°±ä¼šæŠ¥é”™ã€‚è¿™æ—¶ï¼Œ<code>this</code>ç»‘å®šåŸå§‹å¯¹è±¡ï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<pre><code class="javascript">const target = new Date(&#39;2015-01-01&#39;);
const handler = &#123;
  get(target, prop) &#123;
    if (prop === &#39;getDate&#39;) &#123;
      return target.getDate.bind(target);
    &#125;
    return Reflect.get(target, prop);
  &#125;
&#125;;
const proxy = new Proxy(target, handler);

proxy.getDate() // 1</code></pre>
<p>å¦å¤–ï¼ŒProxy æ‹¦æˆªå‡½æ•°å†…éƒ¨çš„<code>this</code>ï¼ŒæŒ‡å‘çš„æ˜¯<code>handler</code>å¯¹è±¡ã€‚</p>
<pre><code class="javascript">const handler = &#123;
  get: function (target, key, receiver) &#123;
    console.log(this === handler);
    return &#39;Hello, &#39; + key;
  &#125;,
  set: function (target, key, value) &#123;
    console.log(this === handler);
    target[key] = value;
    return true;
  &#125;
&#125;;

const proxy = new Proxy(&#123;&#125;, handler);

proxy.foo
// true
// Hello, foo

proxy.foo = 1
// true</code></pre>
<p>ä¸Šé¢ä¾‹å­ä¸­ï¼Œ<code>get()</code>å’Œ<code>set()</code>æ‹¦æˆªå‡½æ•°å†…éƒ¨çš„<code>this</code>ï¼ŒæŒ‡å‘çš„éƒ½æ˜¯<code>handler</code>å¯¹è±¡ã€‚</p>
<h2 id="å®ä¾‹ï¼šWeb-æœåŠ¡çš„å®¢æˆ·ç«¯"><a href="#å®ä¾‹ï¼šWeb-æœåŠ¡çš„å®¢æˆ·ç«¯" class="headerlink" title="å®ä¾‹ï¼šWeb æœåŠ¡çš„å®¢æˆ·ç«¯"></a>å®ä¾‹ï¼šWeb æœåŠ¡çš„å®¢æˆ·ç«¯</h2><p>Proxy å¯¹è±¡å¯ä»¥æ‹¦æˆªç›®æ ‡å¯¹è±¡çš„ä»»æ„å±æ€§ï¼Œè¿™ä½¿å¾—å®ƒå¾ˆåˆé€‚ç”¨æ¥å†™ Web æœåŠ¡çš„å®¢æˆ·ç«¯ã€‚</p>
<pre><code class="javascript">const service = createWebService(&#39;http://example.com/data&#39;);

service.employees().then(json =&gt; &#123;
  const employees = JSON.parse(json);
  // Â·Â·Â·
&#125;);</code></pre>
<p>ä¸Šé¢ä»£ç æ–°å»ºäº†ä¸€ä¸ª Web æœåŠ¡çš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£è¿”å›å„ç§æ•°æ®ã€‚Proxy å¯ä»¥æ‹¦æˆªè¿™ä¸ªå¯¹è±¡çš„ä»»æ„å±æ€§ï¼Œæ‰€ä»¥ä¸ç”¨ä¸ºæ¯ä¸€ç§æ•°æ®å†™ä¸€ä¸ªé€‚é…æ–¹æ³•ï¼Œåªè¦å†™ä¸€ä¸ª Proxy æ‹¦æˆªå°±å¯ä»¥äº†ã€‚</p>
<pre><code class="javascript">function createWebService(baseUrl) &#123;
  return new Proxy(&#123;&#125;, &#123;
    get(target, propKey, receiver) &#123;
      return () =&gt; httpGet(baseUrl + &#39;/&#39; + propKey);
    &#125;
  &#125;);
&#125;</code></pre>
<p>åŒç†ï¼ŒProxy ä¹Ÿå¯ä»¥ç”¨æ¥å®ç°æ•°æ®åº“çš„ ORM å±‚ã€‚</p>

      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³ jaytp@qq.com </span>
    </div>
</article>





    <div id="comments"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

<script type="text/javascript">
    $.getScript('/js/gitalk.js', function () {
        var gitalk = new Gitalk({
            clientID: '',
            clientSecret: '',
            repo: 'yelog.github.io',
            owner: 'yelog',
            admin: ['yelog'],
            id: decodeURI(location.pathname),
            distractionFreeMode: 'true',
            language: 'zh-CN',
            perPage: parseInt('10',10)
        })
        gitalk.render('comments')
    })
</script>




    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    Â©2016-2020 Yelog
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    

    
</style>






<div class="mobile-menus-out" >

</div>
<div class="mobile-menus">
    
    
    <a class="dynamic-menu site_url"   href="/photo">ç›¸å†Œ</a>
    
    
    
</div>


</html>
